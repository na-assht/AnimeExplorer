(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(e){if(e.ep)return;e.ep=!0;const a=n(e);fetch(e.href,a)}})();function $(t){var i=document.getElementById("category-list");fetch("https://api.jikan.moe/v4/genres/anime").then(function(n){return n.json()}).then(function(n){i.innerHTML="",n.data.slice(0,15).forEach(function(o){var e=document.createElement("li");e.innerHTML='<button class="category-btn" data-genreid="'+o.mal_id+'">'+o.name+"</button>",i.appendChild(e)}),document.querySelectorAll(".category-btn").forEach(function(o){o.addEventListener("click",function(){document.querySelectorAll(".category-btn").forEach(function(e){e.classList.remove("active")}),o.classList.add("active"),t(o.getAttribute("data-genreid"))})})}).catch(function(){i.innerHTML="<li>Error loading categories</li>"})}function u(){return JSON.parse(localStorage.getItem("favorieten"))||[]}function k(t){var i=u(),n=i.findIndex(function(o){return o.mal_id===t.mal_id});n===-1?i.push({mal_id:t.mal_id,title:t.title,images:t.images,url:t.url}):i.splice(n,1),localStorage.setItem("favorieten",JSON.stringify(i))}function L(t,i){var n=u(),o=document.getElementById("favoritesList");o.innerHTML="",n.length===0?o.innerHTML='<p style="color:#b5838d;font-size:0.97rem;">No favorites yet.</p>':n.forEach(function(e){var a=document.createElement("div");a.classList.add("anime-card"),a.style.height="auto",a.innerHTML=`
        <img src="${e.images.jpg.large_image_url}" alt="${e.title}">
        <button class="fav-btn favorited" title="Toggle Favorite" data-id="${e.mal_id}">‚ù§Ô∏è</button>
        <h4>${e.title}</h4>
        <button class="details-btn" data-id="${e.mal_id}">Details</button>
      `,o.appendChild(a),a.querySelector(".fav-btn").addEventListener("click",function(r){r.stopPropagation(),t(e),L(t,i)}),a.querySelector(".details-btn").addEventListener("click",function(r){r.stopPropagation(),i(e.mal_id)})})}function b(t,i){var n=u(),o=document.getElementById("anime-list");if(o.innerHTML="",n.length===0){o.innerHTML='<p style="color:#b5838d;font-size:1.1rem;">No favorites yet.</p>';return}n.forEach(function(e){var a=document.createElement("div");a.classList.add("anime-card","visible"),a.innerHTML=`
      <img src="${e.images&&e.images.jpg&&e.images.jpg.large_image_url?e.images.jpg.large_image_url:"https://via.placeholder.com/150x210?text=No+Image"}" alt="${e.title}">
      <button class="fav-btn favorited" title="Toggle Favorite" data-id="${e.mal_id}">‚ù§Ô∏è</button>
      <h4>${e.title}</h4>
      <button class="details-btn" data-id="${e.mal_id}">Details</button>
    `,o.appendChild(a),a.querySelector(".fav-btn").addEventListener("click",function(r){r.stopPropagation(),t(e),b(t,i)}),a.querySelector(".details-btn").addEventListener("click",function(r){r.stopPropagation(),i(e.mal_id)})})}const s=document.getElementById("anime-list"),f=document.getElementById("anime-details");async function y(t,i,n){s.innerHTML="<p>Loading...</p>";try{const e=await(await fetch("https://api.jikan.moe/v4/top/anime?limit=24")).json();v(e.data,t,i,n)}catch{s.innerHTML="<p>Error loading data. Try again later.</p>"}}function M(t,i,n,o){s.innerHTML="<p>Loading...</p>",fetch("https://api.jikan.moe/v4/anime?genres="+t+"&limit=24").then(function(e){return e.json()}).then(function(e){v(e.data,i,n,o)}).catch(function(){s.innerHTML="<p>Error loading data. Try again later.</p>"})}function H(t,i,n,o){s.innerHTML="<p>Loading...</p>",fetch("https://api.jikan.moe/v4/anime?q="+encodeURIComponent(t)+"&limit=24").then(function(e){return e.json()}).then(function(e){v(e.data,i,n,o)}).catch(function(){s.innerHTML="<p>Error loading data. Try again later.</p>"})}function v(t,i,n,o){if(s.innerHTML="",!t||t.length===0){s.innerHTML="<p>No results found.</p>";return}var e=o();t.forEach(function(r){var m=e.some(function(p){return p.mal_id===r.mal_id}),c=document.createElement("div");c.classList.add("anime-card"),c.innerHTML=`
      <img src="${r.images.jpg.large_image_url}" alt="${r.title}">
      <h4>${r.title}</h4>
      <button class="fav-btn${m?" favorited":""}" title="Toggle Favorite" data-id="${r.mal_id}">
        ${m?"‚ù§Ô∏è":"ü§ç"}
      </button>
      <button class="details-btn" data-id="${r.mal_id}">Details</button>
    `,s.appendChild(c),c.querySelector(".fav-btn").addEventListener("click",function(p){p.stopPropagation(),i(r),v(t,i,n,o)}),c.querySelector(".details-btn").addEventListener("click",function(p){p.stopPropagation(),n(r.mal_id)})});const a=new IntersectionObserver((r,m)=>{r.forEach(c=>{c.isIntersecting&&(c.target.classList.add("visible"),m.unobserve(c.target))})},{threshold:.3});document.querySelectorAll(".anime-card").forEach(r=>{a.observe(r)})}function l(t){f.innerHTML='<div class="details-popup"><p>Loading...</p></div>',f.classList.remove("hidden"),fetch("https://api.jikan.moe/v4/anime/"+t).then(function(i){return i.json()}).then(function(i){var n=i.data;f.innerHTML=`
        <div class="details-popup">
          <button id="close-details">‚úñ</button>
          <img src="${n.images.jpg.large_image_url}" alt="${n.title}">
          <h2>${n.title}</h2>
          <p>${n.synopsis?n.synopsis.substring(0,350)+(n.synopsis.length>350?"...":""):"No synopsis available."}</p>
          <p><b>Episodes:</b> ${n.episodes||"N/A"}</p>
          <p><b>Score:</b> ${n.score||"N/A"}</p>
          <a href="${n.url}" target="_blank" rel="noopener noreferrer">View on MyAnimeList</a>
        </div>
      `,document.getElementById("close-details").onclick=function(){f.classList.add("hidden")}}).catch(function(){f.innerHTML='<div class="details-popup"><p>Error loading details.</p><button id="close-details">‚úñ</button></div>',document.getElementById("close-details").onclick=function(){f.classList.add("hidden")}})}const E=document.getElementById("searchBtn"),T=document.getElementById("search"),j=document.getElementById("showFavoritesBtn"),I=document.getElementById("homeBtn"),h=document.getElementById("anime-details");let g=!1;function d(t){k(t),L(d,l),g&&b(d,l)}E.addEventListener("click",function(){const t=T.value.trim();t&&(H(t,d,l,u),_(),g=!1)});T.addEventListener("keydown",function(t){t.key==="Enter"&&E.click()});I.addEventListener("click",function(){y(d,l,u),_(),g=!1});j.addEventListener("click",function(){g=!0,b(d,l)});h.addEventListener("click",function(t){t.target===h&&h.classList.add("hidden")});function _(){document.querySelectorAll(".category-btn").forEach(function(t){t.classList.remove("active")})}$(function(t){M(t,d,l,u),g=!1});y(d,l,u);L(d,l);
